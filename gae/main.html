<html>
    <head>
        <title>Recipe monger</title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script>
            // The current recipe
            var recipe = null;

            var go = function() {
                var url = "/api/scrape?url=" + encodeURI($("#urlbox").val());

                $("button").attr("disalbed", "disabled");
                $("#urlbox").attr("disabled", "disabled");

                $.ajax(url, {
                    dataType: "json",
                    success: function(obj, status) {
                        recipe = obj;

                        $("#recipe").append("<h2>" + obj.name + "</h2>");

                        $("#recipe").append('<img src="' + obj.image + '"/>');

                        var ingredients = "<h3>Ingredients</h3>";
                        ingredients += "<ul>";
                        obj.ingredients.forEach(function(i) {
                            ingredients += "<li>" + i + "</li>";
                        });
                        ingredients += "</ul>";
                        $("#recipe").append(ingredients);

                        var steps = "<h3>Preparation</h3>";
                        steps += "<ol>";
                        obj.steps.forEach(function(s) {
                            steps += "<li>" + s + "</li>";
                        });
                        steps += "</ol>";
                        $("#recipe").append(steps);

                        $("#recipe").append("<button onclick=\"javascript: add();\">Add</button>");
                    }});
            };

            var add = function() {
                $.ajax("/api/add", {
                    type: "POST",
                    data: {recipe: JSON.stringify(recipe)},
                    dataType: "json"});
            };
        </script>
    </head>

    <body>
        <div style="text-align: center">
            <input type="text" id="urlbox" style="font-size: 18pt; width: 60%"/>
            <button style="font-size: 18pt" onclick="javascript:go();">Go</button>
        </div>

        <div id="recipe"/>
    </body>
</html>
